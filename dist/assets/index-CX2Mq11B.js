import{g as t,e}from"./pdf-lib-CN1cwKqm.js";const n=t(e);
/**
 * pdf-encrypt-lite - Ultra-lightweight PDF encryption library
 * Powers PDFSmaller.com's PDF encryption tool
 * 
 * @author PDFSmaller.com (https://pdfsmaller.com)
 * @license MIT
 * @see https://pdfsmaller.com/protect-pdf - Try it online!
 * 
 * This minimal cryptographic implementation was built to solve the "impossible" 
 * problem of real PDF encryption within Cloudflare Workers' 1MB limit.
 * Total size: ~7KB for complete PDF encryption!
 */const s=t(Object.freeze(Object.defineProperty({__proto__:null,RC4:class{constructor(t){this.s=new Uint8Array(256),this.i=0,this.j=0;for(let n=0;n<256;n++)this.s[n]=n;let e=0;for(let n=0;n<256;n++)e=e+this.s[n]+t[n%t.length]&255,[this.s[n],this.s[e]]=[this.s[e],this.s[n]]}process(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++){this.i=this.i+1&255,this.j=this.j+this.s[this.i]&255,[this.s[this.i],this.s[this.j]]=[this.s[this.j],this.s[this.i]];const s=this.s[this.i]+this.s[this.j]&255;e[n]=t[n]^this.s[s]}return e}},bytesToHex:function(t){return Array.from(t).map(t=>t.toString(16).padStart(2,"0")).join("")},hexToBytes:function(t){const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++)e[n]=parseInt(t.substr(2*n,2),16);return e},md5:function(t){const e="string"==typeof t?(new TextEncoder).encode(t):t,n=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],s=new Uint32Array([3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745]);let r=1732584193,o=4023233417,i=2562383102,c=271733878;const a=e.length,l=8*a,f=a+9+63&-64,h=new Uint8Array(f);h.set(e),h[a]=128;const g=new DataView(h.buffer);g.setUint32(f-8,l,!0),g.setUint32(f-4,0,!0);for(let w=0;w<f;w+=64){const t=new Uint32Array(h.buffer,w,16);let e=r,a=o,l=i,f=c;for(let r=0;r<64;r++){let o,i;r<16?(o=a&l|~a&f,i=r):r<32?(o=f&a|~f&l,i=(5*r+1)%16):r<48?(o=a^l^f,i=(3*r+5)%16):(o=l^(a|~f),i=7*r%16),o=o+e+s[r]+t[i]>>>0,e=f,f=l,l=a,a=a+(o<<n[r]|o>>>32-n[r])>>>0}r=r+e>>>0,o=o+a>>>0,i=i+l>>>0,c=c+f>>>0}const u=new Uint8Array(16),y=new DataView(u.buffer);return y.setUint32(0,r,!0),y.setUint32(4,o,!0),y.setUint32(8,i,!0),y.setUint32(12,c,!0),u}},Symbol.toStringTag,{value:"Module"}))),{PDFDocument:r,PDFName:o,PDFHexString:i,PDFString:c,PDFDict:a,PDFArray:l,PDFRawStream:f,PDFNumber:h}=n,{md5:g,RC4:u,hexToBytes:y,bytesToHex:w}=s,d=new Uint8Array([40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122]);function p(t){const e=(new TextEncoder).encode(t),n=new Uint8Array(32);return e.length>=32?n.set(e.slice(0,32)):(n.set(e),n.set(d.slice(0,32-e.length),e.length)),n}function U(t,e,n,s){const r=new Uint8Array(s.length+5);r.set(s),r[s.length]=255&e,r[s.length+1]=e>>8&255,r[s.length+2]=e>>16&255,r[s.length+3]=255&n,r[s.length+4]=n>>8&255;const o=g(r);return new u(o.slice(0,Math.min(s.length+5,16))).process(t)}function A(t,e,n,s){if(t)if(t instanceof c){const r=U(t.asBytes(),e,n,s);t.value=w(r)}else if(t instanceof i){const r=U(y(t.asString()),e,n,s);t.value=w(r)}else if(t instanceof a){const r=t.entries();for(const[t,o]of r){const r=t.asString();"/Length"!==r&&"/Filter"!==r&&"/DecodeParms"!==r&&A(o,e,n,s)}}else if(t instanceof l){const r=t.asArray();for(const t of r)A(t,e,n,s)}}var m=async function(t,e,n=null){try{const s=await r.load(t,{ignoreEncryption:!0,updateMetadata:!1}),c=s.context;let l;const m=c.trailerInfo,D=m.ID;if(D&&Array.isArray(D)&&D.length>0){const t=D[0].toString().replace(/^<|>$/g,"");l=y(t)}else{const t=new Uint8Array(16);if("undefined"!=typeof crypto&&crypto.getRandomValues)crypto.getRandomValues(t);else for(let s=0;s<16;s++)t[s]=Math.floor(256*Math.random());l=t;const e=i.of(w(l)),n=i.of(w(l));m.ID=[e,n]}const b=4294967292,F=function(t,e){const n=p(t||e);let s=g(n);for(let i=0;i<50;i++)s=g(s);const r=p(e);let o=new Uint8Array(r);for(let i=0;i<20;i++){const t=new Uint8Array(s.length);for(let e=0;e<s.length;e++)t[e]=s[e]^i;o=new u(t.slice(0,16)).process(o)}return o}(n,e),j=function(t,e,n,s){const r=p(t),o=new Uint8Array(r.length+e.length+4+s.length);let i=0;o.set(r,i),i+=r.length,o.set(e,i),i+=e.length,o[i++]=255&n,o[i++]=n>>8&255,o[i++]=n>>16&255,o[i++]=n>>24&255,o.set(s,i);let c=g(o);for(let a=0;a<50;a++)c=g(c.slice(0,16));return c.slice(0,16)}(e,F,b,l),P=function(t,e){const n=new Uint8Array(d.length+e.length);n.set(d),n.set(e,d.length);const s=g(n);let r=new u(t).process(s);for(let i=1;i<=19;i++){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t[n]^i;r=new u(e).process(r)}const o=new Uint8Array(32);return o.set(r),o.set(new Uint8Array(16),16),o}(j,l),S=c.enumerateIndirectObjects();for(const[t,e]of S){const n=t.objectNumber,s=t.generationNumber||0;if(e instanceof a){const t=e.get(o.of("Filter"));if(t&&"/Standard"===t.asString())continue}if(e instanceof f){const t=U(e.contents,n,s,j);e.contents=t}A(e,n,s,j)}const x=c.obj({Filter:o.of("Standard"),V:h.of(2),R:h.of(3),Length:h.of(128),P:h.of(b),O:i.of(w(F)),U:i.of(w(P))}),T=c.register(x);m.Encrypt=T;return await s.save({useObjectStreams:!1})}catch(s){throw console.error("PDF encryption error:",s),new Error(`Failed to encrypt PDF: ${s.message}`)}};export{m as encryptPDF};
